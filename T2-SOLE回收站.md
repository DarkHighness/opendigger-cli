# 命令行交互的指标结果查询子模块 产品设计文档

[toc]

## 一 项目背景

​	近年来，GitHub等代码托管平台已成为程序员、开发者之间交流和合作的重要平台。对于项目质量的评估，在平台上一直是一个十分重要的话题。其中，项目的GitHub指标成为评估项目的重要因素之一。而OpenDigger 作为开源生态数据分析的核心项目，负责与开源测量学相关的一切数据、指标、模型、算法等落库与实现，是一个具有共识性的实施标准工具集。目前，OpenDigger提供的这些指标以 HTTPS URL 的形式提供 JSON 数据文件的查询结果，用户想查询某一个仓库在某一个指标的对应数据时，可以通过修改 URL 的方式得到。
​	现在，随着人们对命令行交互的需求越来越高，我们可以考虑使用命令行查看OpenDigger的指标结果。命令行交互的优势在于，它不依赖于图形用户界面（GUI），无需鼠标和其他外设，可以通过键盘快捷键和命令行输入与程序进行交互。这使得命令行交互成为一种高效、快捷的交互方式，特别在需要快速访问和操作多个文件、目录和系统层面时，在效率上有着优势。对很多开发者而言，命令行交互的方式相比修改url更加快捷，方便他们基于此做更多开发工作。
​	本项目的目标在于，通过命令行交互方式，使OpenDigger提供一种方便、快捷的指标查询方式，用户可以利用OpenDigger提供的命令接口，查询GitHub上的指定仓库在各种指标上的表现，并在命令行界面上直接得到查询结果和相关信息或者得到一份下载文件。通过命令行交互的方式，用户可以不必登录任何平台或第三方网站，直接在控制台上查询和处理GitHub项目指标信息，这使得OpenDigger可以更快速、方便地提供GitHub项目指标查询服务，为项目评估和开发带来更高效的方式。

## 二 用户需求分析

### （1）用户类型

- 开发人员：有相关的计算机基础知识和编程能力，希望通过OpenDigger发掘Github上项目的指标信息。熟悉命令行界面，能够快速找到合适的交互方式。
- 项目管理人员：本身参与了自己项目的管理，希望通过OpenDigger找到自己参与的项目的指标信息，进行相关数据分析，得到项目优化方向。大部分有命令行使用经验。
- 普通用户：希望能够使用OpenDigger得到新的指标信息，用于非计算机相关的其他领域。工程经验可能不足，需要专业门槛较低的命令行使用方案。

### （2）用户需求

​	通过命令行工具，用户能够得到相应的查询结果，包括：

1. 查询**特定仓库**在**特定指标**上的数据

2. 查询**特定仓库**在**某一类指标**上的数据

3. 查询**特定仓库**在**特定自然月**上在**特定指标**上的数据

4. 查询**特定仓库**在**特定自然月**上在**某一类指标**上的数据

5. 查询**特定仓库**在**特定自然月份**上的**整体报告**

6. 查询**特定仓库**在**特定自然月份**上的在**某一类指标**上的报告

7. 查询**特定用户**在**特定指标**上的数据

8. 查询**特定用户**在**特定自然月**上在**特定指标**上的数据

9. 查询**特定用户**在**特定自然月份**上的**整体报告**

   

   注意命令行交互虽然简洁，但有一定的专业性。我们的目标是让所有用户（包括计算机相关专业和非计算机相关专业的用户）能够轻松地使用产品，并获得愉悦的使用体验。

   ------

   同时查询得到的整体报告应当有一定的可视化设计，以图表、图像等形式表达数据和信息，具有良好的可读性和表现力，节省用户的时间和精力，使用户可以更深入地探究数据并进行进一步分析。



## 三 产品功能设计

该命令行工具的功能设计包括五个模块：

### 功能1：基本数据查询

使用gluesql轻量级数据库

查询特定仓库（或者特定用户）在特定指标（或者某一类指标）上的数据

这一部分功能实现的查询种类比较多，但查询结果大部分是数值或者数组，可以返回给用户一个简单的结果

```bash
> ./opendigger-cli sql "select * from Openrank l left join Activity where l.name='X-lab2017/open-digger'"
```

### 功能2：数据查询报告

针对特定仓库或者特定用户，不指定指标，给出一份在特定自然月上的整体报告，报告包含各类指标，并且以图表的形式展现

```bash
> ./opendigger-cli report 'X-lab2017/open-digger' '2022-06'
```

### 功能3：图数据查询

注意指标中有一部分本身就是图状数据，例如开发者之间的网络、仓库之间的网络，对于这部分数据，我们考虑返回完成图可视化的网页

### 功能4：查询语句AI生成

我们关注普通用户的需求，对于不了解SQL的用户，我们考虑在命令行工具中结合ChatGPT相关功能。用户可以描述自己的需求，由我们帮助用户生成SQL查询语句。

```bash
>./opendigger-cli chat "仓库'X-lab2017/open-digger’,'vuejs/core'stars 数量的变化，包含仓库名称"
```

### 功能5：多种结果展现方式

```bash
Options:
	-o 输出到文件
	--ui 使用交互式ui
	download 支持下载整体报告
```

## 四 产品架构和技术方案

### 1.产品架构

### 2.技术方案

1. 开发工具: 使用RUST作为开发语言。RUST是一种高性能、可靠、安全的系统编程语言，并且具有出色的并发和内存管理能力。
2. 数据库: 选择使用gluesql作为轻量级数据库，易于使用和管理。gluesql还支持内存和磁盘存储、索引和版本控制等功能，有助于提高应用程序的性能和功能。
3. ChatGPT引用：配置OPENAI_API_KEY，使命令行工具支持ChatGPT生成查询语句
4. 使用TUI交互
5. DevOps自动构建

## 五 项目排期和未来工作

- [x] 2023年5月1日前：开会，分工，完成该项目的方案设计和前期准备
- [x] 2023年5月5日前：在代码中完成基本数据下载
- [x] 2023年5月10日前：完成基本数据查询
- [x] 2023年5月15日前：完成ChatGPT支持查询语句生成
- [x] 2023年5月22日前：完成复赛方案提交和Demo演示
- [ ] 2023年5月30日前：完成图数据查询
- [ ] 2023年6月5日前：完成查询报告的可视化
- [ ] 2023年6月15日前：完成项目测试和调整完善
- [ ] 2023年6月20日前：完成产品说明书撰写，介绍如何安装和二次开发
- [ ] 2023年6月25日前：完成决赛提交需要的完整内容，使用在线视频进行项目演示

## 六 产品Demo和项目进度

**该CLI工具支持的命令行参数：**

![help](https://github.com/nicole01101101zke/opendigger-cli/assets/60032364/45e234cb-078b-4f0b-b410-11f093c29155)

**完成基本数据查询功能：**

![basicquery1](https://github.com/nicole01101101zke/opendigger-cli/assets/60032364/51eea0f7-6c11-4a27-a128-4627d3e6c1c1)


**支持查询结果写入文件：**

![basicquery](https://github.com/nicole01101101zke/opendigger-cli/assets/60032364/e8eb89e7-c89e-4796-bc74-1d4eaa45390a)


**支持查询结果TUI交互：**

![TUI](https://github.com/nicole01101101zke/opendigger-cli/assets/60032364/323c6aab-041e-4854-8097-4f845f4ca128)

**ChatGPT支持生成查询语句，并产生最终结果：**

![chatgpt](https://github.com/nicole01101101zke/opendigger-cli/assets/60032364/3ff969cf-6377-42b7-aaa1-f81fa288c92f)

**DevOps自动构建：**

![devops](https://github.com/nicole01101101zke/opendigger-cli/assets/60032364/d7b78d72-6185-4810-8969-4fb39f37225e)
